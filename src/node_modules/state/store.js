import { GO_TO_LOCATION, INIT_FROM_LOCATION, SCROLL_LOCATION, UPDATE_LOCATION } from "state/navigation/actions";
import { ERROR_THROWN } from "state/error/actions";
import { OWNER_LOAD, OWNER_VERIFY } from "state/owner/actions";
import { CONNECT_TO_HOME, HOME_OWNER_VERIFY } from "state/home/actions";
import { REGISTER_NAME, REGISTERED_NAME_LOAD, REGISTERED_NAME_UPDATE } from "state/registeredname/actions";
import { PROFILE_LOAD, PROFILE_UPDATE } from "state/profile/actions";
import { TIMELINE_FUTURE_SLICE_LOAD, TIMELINE_GENERAL_LOAD, TIMELINE_PAST_SLICE_LOAD } from "state/timeline/actions";
import { DETAILED_POSTING_LOAD } from "state/detailedposting/actions";
import { COMPOSE_FEATURES_LOAD, COMPOSE_POST, COMPOSE_POSTING_LOAD } from "state/compose/actions";

import { applyMiddleware, combineReducers, createStore } from 'redux';
import error from "state/error/reducer";
import naming from "state/naming/reducer";
import node from "state/node/reducer";
import home from "state/home/reducer";
import tokens from "state/tokens/reducer";
import navigation from "state/navigation/reducer";
import connectDialog from "state/connectdialog/reducer";
import owner from "state/owner/reducer";
import registeredName from "state/registeredname/reducer";
import profile from "state/profile/reducer";
import detailedPosting from "state/detailedposting/reducer";
import compose from "state/compose/reducer";
import postings from "state/postings/reducer";
import timeline from "state/timeline/reducer";
import messageBox from "state/messagebox/reducer";
import confirmBox from "state/confirmbox/reducer";

import createSagaMiddleware from 'redux-saga';
import { spawn, takeEvery, takeLatest } from 'redux-saga/effects';
import { pulseSaga } from "state/pulse/sagas";
import { goToLocationSaga, initFromLocationSaga, updateLocationSaga } from "state/navigation/sagas";
import { errorSaga } from "state/error/sagas";
import { ownerLoadSaga, ownerVerifySaga } from "state/owner/sagas";
import { connectToHomeSaga, verifyHomeOwnerSaga } from "state/home/connect";
import { registeredNameLoadSaga, registeredNameUpdateSaga, registerNameSaga } from "state/registeredname/sagas";
import { profileLoadSaga, profileUpdateSaga } from "state/profile/sagas";
import { timelineFutureSliceLoadSaga, timelineGeneralLoadSaga, timelinePastSliceLoadSaga } from "state/timeline/sagas";
import { detailedPostingLoadSaga } from "state/detailedposting/sagas";
import { composeFeaturesLoadSaga, composePostingLoadSaga, composePostSaga } from "state/compose/sagas";

import { collectTriggers, invokeTriggers } from "state/trigger";
import homeTriggers from "state/home/triggers";
import navigationTriggers from "state/navigation/triggers";
import ownerTriggers from "state/owner/triggers";
import registeredNameTriggers from "state/registeredname/triggers";
import profileTriggers from "state/profile/triggers";
import timelineTriggers from "state/timeline/triggers";
import detailedPostingTriggers from "state/detailedposting/triggers";
import composeTriggers from "state/compose/triggers";

const triggers = collectTriggers(
    homeTriggers,
    navigationTriggers,
    ownerTriggers,
    registeredNameTriggers,
    profileTriggers,
    timelineTriggers,
    detailedPostingTriggers,
    composeTriggers
);

function* combinedSaga() {
    yield spawn(pulseSaga);
    yield takeLatest(INIT_FROM_LOCATION, initFromLocationSaga);
    yield takeEvery(UPDATE_LOCATION, updateLocationSaga);
    yield takeEvery(SCROLL_LOCATION, updateLocationSaga);
    yield takeLatest(GO_TO_LOCATION, goToLocationSaga);
    yield takeLatest(ERROR_THROWN, errorSaga);
    yield takeLatest(OWNER_LOAD, ownerLoadSaga);
    yield takeLatest(OWNER_VERIFY, ownerVerifySaga);
    yield takeLatest(CONNECT_TO_HOME, connectToHomeSaga);
    yield takeLatest(HOME_OWNER_VERIFY, verifyHomeOwnerSaga);
    yield takeLatest(REGISTERED_NAME_LOAD, registeredNameLoadSaga);
    yield takeLatest(PROFILE_LOAD, profileLoadSaga);
    yield takeLatest(PROFILE_UPDATE, profileUpdateSaga);
    yield takeLatest(REGISTER_NAME, registerNameSaga);
    yield takeLatest(REGISTERED_NAME_UPDATE, registeredNameUpdateSaga);
    yield takeLatest(TIMELINE_GENERAL_LOAD, timelineGeneralLoadSaga);
    yield takeLatest(TIMELINE_PAST_SLICE_LOAD, timelinePastSliceLoadSaga);
    yield takeLatest(TIMELINE_FUTURE_SLICE_LOAD, timelineFutureSliceLoadSaga);
    yield takeLatest(DETAILED_POSTING_LOAD, detailedPostingLoadSaga);
    yield takeLatest(COMPOSE_FEATURES_LOAD, composeFeaturesLoadSaga);
    yield takeLatest(COMPOSE_POSTING_LOAD, composePostingLoadSaga);
    yield takeLatest(COMPOSE_POST, composePostSaga);

    yield invokeTriggers(triggers);
}

const sagaMiddleware = createSagaMiddleware();
export default createStore(
    combineReducers({
        error,
        naming,
        node,
        home,
        tokens,
        navigation,
        connectDialog,
        owner,
        registeredName,
        profile,
        detailedPosting,
        compose,
        postings,
        timeline,
        messageBox,
        confirmBox
    }),
    applyMiddleware(sagaMiddleware)
);

sagaMiddleware.run(combinedSaga);
