import { select, call, put, apply } from 'redux-saga/effects';

import { NodeError } from "error";
import { errorThrown } from "error/actions";
import { profileSet } from "profile/actions";

export function* profileLoadSaga() {
    const rootApi = yield select(state => state.root.api);
    try {
        let response;
        try {
            response = yield call(fetch, rootApi + "/profile");
        } catch (e) {
            throw new NodeError(e);
        }
        if (!response.ok) {
            throw new NodeError("Server returned error status");
        }
        const data = yield apply(response, response.json);
        yield put(profileSet(data));
    } catch (e) {
        yield put(errorThrown(e));
    }
}
