import React from 'react';
import { connect } from 'react-redux';
import cx from 'classnames';

import { REACTION_EMOJIS } from "api";
import { Twemoji } from "ui/control";
import { postingReact } from "state/postings/actions";
import { MAIN_NEGATIVE_REACTIONS, MAIN_POSITIVE_REACTIONS } from "api/node/reaction-emojis";
import { getSetting } from "state/settings/selectors";
import "./ReactionSelector.css";

const ReactionChoiceImpl = ({id, negative, emoji, invisible, postingReact}) => {
    const re = !negative ? REACTION_EMOJIS.positive[emoji] : REACTION_EMOJIS.negative[emoji];
    return (
        <div className={cx("choice", {invisible})} onClick={e => postingReact(id, negative, emoji)}>
            <Twemoji key={emoji} code={emoji} title={re ? re.title : ""}/>
        </div>
    );
};

const ReactionChoice = connect(
    null,
    { postingReact }
)(ReactionChoiceImpl);

const ReactionSelector = ({id, negative, positiveAvailable, negativeAvailable}) => {
    const availableList = (!negative ? positiveAvailable : negativeAvailable).split(",");
    const available = new Set(availableList.map(v => parseInt(v)));
    const reactions = (!negative ? MAIN_POSITIVE_REACTIONS : MAIN_NEGATIVE_REACTIONS)
        .concat(availableList.filter(r => r.startsWith("+")).map(v => parseInt(v)));
    return (
        <div className="reaction-selector">
            {reactions.map(emoji =>
                <ReactionChoice key={emoji} id={id} negative={negative} emoji={emoji}
                                invisible={!available.has(emoji)}/>
            )}
        </div>
    );
};

export default connect(
    state => ({
        positiveAvailable: getSetting(state, "reactions.positive.available"),
        negativeAvailable: getSetting(state, "reactions.negative.available")
    })
)(ReactionSelector);
