import React from 'react';
import { connect } from 'react-redux';

import { Button, Loading, Popover, RegisteredName } from "control";
import ConnectDialog from "logobar/connectionstatus/connectdialog/ConnectDialog";
import { openConnectDialog } from "logobar/connectionstatus/connectdialog/actions";
import { disconnectFromHome } from "home/actions";
import { isConnectedToHome } from "home/selectors";
import "logobar/connectionstatus/ConnectionStatus.css";

const ConnectionStatus = ({connecting,  connected, location, login, owner, openConnectDialog, disconnectFromHome}) => (
    <>
        <div id="connection-status">{
            connecting ?
                <>Connecting <Loading color="white" /></>
            :
                (!connected ?
                    <>
                        You are not connected to home
                        <Button variant="success" onClick={openConnectDialog}>Connect</Button>
                    </>
                :
                    <>
                        You are{" "}
                        <Popover text="connected" textClassName="connection-details">
                            Connected to <a href={location}>{location}</a> as <b>{login}</b>
                            {owner.name && <><br />Signing as <RegisteredName {...owner} /></>}
                        </Popover>
                        {" "}to home
                        <Button variant="outline-primary" onClick={() => disconnectFromHome(location)}>
                            Disconnect
                        </Button>
                    </>
            )
        }</div>
        <ConnectDialog />
    </>
);

export default connect(
    (state) => ({
        connecting: state.home.connecting,
        connected: isConnectedToHome(state),
        location: state.home.root.location,
        login: state.home.login,
        owner: state.home.owner
    }),
    { openConnectDialog, disconnectFromHome }
)(ConnectionStatus);
